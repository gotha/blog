---
title: "Как да си направим Time Machine сървър"
date: "2016-02-03"
categories: 
  - "howto"
  - "mac"
---

Ако не сте използвали [Time Machine](https://en.wikipedia.org/wiki/Time_Machine_(OS_X))  до сега трябва да знаете, че както всичко Apple-ско работи доста добре и е страхотен начин за правене на backups. Задължително е поне да се пробва .

Има два начина да правите резервни копия - на втори хард диск или през мрежата. С втори диск всичко си работи добре, но често забравяте да го свържете отново след като си преместите компютъра, ако имате 2 usb порта не искате единия да е постоянно зает и т.н. Да се синхронизира през мрежата е най-удобно, но единствения официален начин това да става е чрез [Apple Time Capsule](http://www.apple.com/shop/product/ME177LL/A/airport-time-capsule-2tb), която в момента струва 300$ или 640 лева в CreativeCenter.

Ако като мен имате някоя стара машина (или в моя случай стари служебни непотребни компютри), която не въши нищо можете да направите следното.

1\. Инсталирате някакъв Linux, в моя случай сложих Ubuntu Server последния LTS, просто защото не ми се заниваше сериозно.

2\. Инсталирате netatalk, това е софтуер, който поддържа Apple Filing Protocol. При Ubuntu го има в хранилищата, така че просто едно

sudo apt-get install netatalk

ще свърши работа

3\. Създаваме папката, където ще ни се съхраняват backup-ите

mkdir /mnt/TimeMachine

4\. Добавяме в конфигурационния файл "/etc/AppleVolumes.default":

/mnt/TimeMachine/ "Time Machine" options:tm volsizelimit:600000 allow:gotha

Мисля че няма много нужда от обяснения, но все пак - задавате път, име на "диска", който ще бъде споделен по мрежата, volsizelimit е колко голям може да е този диск - в моя случай ~600GB и накрая казвате кой системен потребител има право да го достъпва, при мен е gotha, при вас най-вероятно няма да е. Потребителя трябва да има права за четене и писане в тази директория.

5\. Рестартирате сървъра

sudo /etc/init.d/netatalk restart

трябва да свърши работа.

Сега следва на направим правилните настройки на нашия Мак или Hackintosh. Този диск е "unsupported" и операционната система няма да ни позволи да се закачим към него.

6\. Казваме на Mac OS, че не държим диска да е supported

defaults write com.apple.systempreferences TMShowUnsupportedNetworkVolumes 1

7\. Връзваме се към сървъра през Finder. В Network папката трябва да виждате вече сървъра, връзваме се към него с потребителското име и паролата, която използваме на Linux-ката машина и му казваме да ни запомни данните.

8\. Препоръчително е този диск да се монтира автоматично при стартиране на компютъра, за целта отиваме в

- System Preferences
- Users & Groups
- избираме нашия потребител
- кликаме на таба Login Items
- кликаме плюса долу и добавяме папката "Time Machine"

9\. Правим си настройките на Time Machine В System Preferences -> Time Machine изберете големия бутон с надпис ON и OFF. За нашите цели ON е добър старт. TM ще ви попита кой диск искате да ползвате избирате мрежовия диск, слагате tick-че на "Encrypt backups" и потвърждавате. Ще ви пита и за парола за криптирането и сте готови. Първия backup ще е отнеме доста време, но след това нещата са много по-бързи и лесни. Ползвам подобна конфигурация вече месец и нямам никакви проблеми. Не забравяйте, че обикновено когато ти потрябва backup вече е прекалено късно, поиграйте си половин-един час и си спестете ядовете после.

10\. Profit !
